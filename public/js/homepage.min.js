let localCountry={name:"Global",code:"global"},createChart=!0,globalChartElem=document.getElementById("globalChart").getContext("2d");function getPreferredCountries(){let a=["global","cn","it","us"],b=!0;return a.forEach(function(c){if(c==localCountry.code)return b=!1,a}),b&&a.push(localCountry.code),a}$("#country_selector").countrySelect({preferredCountries:getPreferredCountries(),excludeCountries:["AS","AO","AI","AX","BB","BZ","BJ","BM","BQ","BW","IO","IM","VG","CG","BN","MM","BI","CC","CV","ID","KM","CK","GS","CW","CX","DJ","DM","SV","ER","FK","FO","FM","FJ","GF","PF","GI","GL","GD","GU","GW","HT","HK","KI","KY","KG","LA","LS","LR","LY","MO","MG","MW","ML","MH","MU","YT","ME","MS","MZ","NR","AN","NC","NI","NE","NU","NF","KP","MP","PW","PG","PR","RE","BL","SH","KN","MF","PM","WS","ST","SL","SX","SB","SO","SS","SY","TW","TJ","TZ","BS","GM","TL","TK","TO","TM","TC","TD","TV","UG","UM","VI","VU","VA","WF","EH","YE","ZM","ZW"]});let stats,text=JSON.parse($("#texts").text());$("#texts").remove();let colorNum=0;function getColor(){return colorNum++,"hsl("+40*colorNum%360+",100%,50%)"}function setBackground(a,b,c,d,e,f,g){b.backgroundColor=e,c.backgroundColor=f,d.backgroundColor=g,a.update()}$("#country_selector").focus(function(){$("#country_selector").val("")});function updateChart(){createChart&&(createChart=!1,newChart());let a=!1;return globalChart.data.datasets.forEach(function(b,c){if(`${text.CONFIRMED} ${localCountry.name}`==b.label){let b=globalChart.data.datasets;return setTimeout(setBackground.bind(null,globalChart,b[c],b[c+1],b[c+2],b[c].backgroundColor,b[c+1].backgroundColor,b[c+2].backgroundColor),1500),b[c].backgroundColor=b[c].borderColor,b[c+1].backgroundColor=b[c+1].borderColor,b[c+2].backgroundColor=b[c+2].borderColor,globalChart.update(),a=!0,!1}}),!a&&void($(".no-nations").remove(),$("#section1").append(`<div><p class="delete-country" onclick="countryCheckbox(this)" id="${localCountry.code}"><img src="/img/cross.svg" alt="Delete" style="max-width: 1rem;"> <img src="/img/flags/${localCountry.code}.png" alt="Flag" style="max-width: 1rem;"> <span class="country-name strike-link">${localCountry.name}</span></p></div>`),globalChart.data.datasets.push({label:`${text.CONFIRMED} ${localCountry.name}`,borderColor:getColor(),data:stats.map(a=>a.confirmed)}),globalChart.data.datasets.push({label:`${text.RECOVERIES} ${localCountry.name}`,borderColor:getColor(),data:stats.map(a=>a.recovered)}),globalChart.data.datasets.push({label:`${text.DEATHS} ${localCountry.name}`,borderColor:getColor(),data:stats.map(a=>a.deaths)}),globalChart.resetZoom(),globalChart.update())}function getCountry(a){$("#country_selector").blur(),$("#loading-container").show(),$.ajax({url:"/api/"+localCountry.name,success:function(a){try{stats=JSON.parse(a.responseText)}catch(b){stats=a}},error:function(a){alert(`${a.status} ${a.statusText}, ${text.CANT_REQUEST} /${localCountry.name}: ${a.responseText}. ${text.ERROR_LETMEKNOW}`)},complete:function(){$("#loading-container").hide(),a&&a()}})}$("#tutorial").on("click",function(){$(this).remove()});let findTimer=!1;$("#country_selector").on("change",function(){changeCountry()}),$("#showStats").on("click",function(){changeCountry()});function changeCountry(){findTimer||(findTimer=setTimeout(function(){findTimer=!1,$("#showStats").prop("disabled",!1)},1e3),$("#showStats").prop("disabled",!0),$("#tutorial").remove(),updateCountry(),getCountry(updateChart))}$("#country_selector").on("keypress",function(a){13==a.which&&$(this).blur()}),"404"==localCountry.name?updateCountry():$("#country_selector").countrySelect("setCountry",localCountry.name);function updateCountry(){localCountry={name:$("#country_selector").countrySelect("getSelectedCountryData").name.replace(/ *\([^)]*\) */g,""),code:$("#country_selector").countrySelect("getSelectedCountryData").iso2}}Chart.pluginService.register({beforeDraw:function(a){if(a.config.options.chartArea&&a.config.options.chartArea.backgroundColor){var b=Chart.helpers,c=a.chart.ctx,d=a.chartArea;c.save(),c.fillStyle=a.config.options.chartArea.backgroundColor,c.fillRect(d.left,d.top,d.right-d.left,d.bottom-d.top),c.restore()}},afterRender:function(a){var b=a.chart.ctx;b.save(),b.globalCompositeOperation="destination-over",b.fillStyle="white",b.fillRect(0,0,a.chart.width,a.chart.height),b.restore()}});let watermarkProp={};$(document).width()>$(document).height()?(watermarkProp.width=$(document).width()/8,watermarkProp.height=$(document).width()/32,watermarkProp.pr=100,watermarkProp.pb=100,watermarkProp.opacity=.2):(watermarkProp.width=$(document).height()/8,watermarkProp.height=$(document).height()/32,watermarkProp.pr=10,watermarkProp.pb=60,watermarkProp.opacity=.2);let globalChart;function newChart(){globalChart=new Chart(globalChartElem,{type:"line",data:{labels:stats.map(a=>`${new Date(a.date).getDate()}/${new Date(a.date).getMonth()+1}`),datasets:[{label:`${text.CONFIRMED} ${localCountry.name}`,borderColor:getColor(),data:stats.map(a=>a.confirmed)},{label:`${text.RECOVERIES} ${localCountry.name}`,borderColor:getColor(),data:stats.map(a=>a.recovered)},{label:`${text.DEATHS} ${localCountry.name}`,borderColor:getColor(),data:stats.map(a=>a.deaths)}]},options:{chartArea:{backgroundColor:"#fff"},legend:{labels:{fontColor:"black",fontSize:14}},scales:{yAxes:[{type:"linear",ticks:{fontColor:"black"},scaleLabel:{display:!0,labelString:text.PEOPLE,fontColor:"black",fontSize:14}}],xAxes:[{ticks:{fontColor:"black"},scaleLabel:{display:!0,labelString:text.DATE,fontColor:"black",fontSize:14}}]},elements:{point:{radius:4,hoverRadius:7,hitRadius:10},line:{borderWidth:4}},responsive:!0,responsiveAnimationDuration:200,maintainAspectRatio:!1,plugins:{zoom:{pan:{enabled:!0,mode:"y",speed:10,threshold:10},zoom:{enabled:!0,sensitivity:1,mode:"y",sensitivity:.1}}},watermark:{image:"/img/watermark.png",x:watermarkProp.pr,y:watermarkProp.pb,width:watermarkProp.width,height:watermarkProp.height,opacity:watermarkProp.opacity,alignX:"right",alignY:"bottom",alignToChartArea:!1,position:"front"}}}),$("#chartOptions").show(),$(".no-nations").remove(),$("#section1").append(`<div><p class="delete-country" onclick="countryCheckbox(this)" id="${localCountry.code}"><img src="/img/cross.svg" alt="Delete" style="max-width: 1rem;"> <img src="/img/flags/${localCountry.code}.png" alt="Flag" style="max-width: 1rem;"> <span class="country-name strike-link">${localCountry.name}</span></p></div>`)}function countryCheckbox(a){globalChart.data.datasets.forEach(function(b,c){if(`${text.CONFIRMED} ${$("#"+a.id).children(".country-name").text()}`==b.label)return globalChart.data.datasets.splice(c,3),$("#"+a.id).remove(),$("#section1").text().trim()==text.SELECTED_COUNTRIES+":"&&$("#section1").append(`<p class="no-nations text-muted" style="font-size: 0.8rem">${text.NO_COUNTRIES}</p>`),globalChart.update(),!1})}$("#saveAsImage").click(function(){$(this).attr("href",globalChart.toBase64Image())});function canvasToImage(a){var b=new Image;return b.src=a.toDataURL("image/png"),b}$("input[type=radio][name=axisType]").change(function(){globalChart.options.scales.yAxes[0].type=this.value,globalChart.resetZoom(),globalChart.update()}),$("input[type=radio][name=chartType]").change(function(){"bar"==this.value?globalChart.data.datasets.forEach(function(a){a.backgroundColor=getColor()}):globalChart.data.datasets.forEach(function(a){a.backgroundColor=void 0}),globalChart.config.type=this.value,globalChart.resetZoom(),globalChart.update()}),$("input[type=radio][name=textStyle]").change(function(){globalChart.options.legend.labels.fontStyle=this.value,globalChart.options.scales.yAxes[0].ticks.fontStyle=this.value,globalChart.options.scales.xAxes[0].ticks.fontStyle=this.value,globalChart.update()});const shareInterval=setInterval(function(){$(".st-label").each(function(){"Share"==$(this).text()&&"Share"!=text.SHARE&&($(this).text(text.SHARE),clearInterval(shareInterval))})},1e3);$("#resetZoom").on("click",function(){globalChart.resetZoom()}),$("#datasetBackground").change(function(){this.checked?(globalChart.data.datasets.forEach(function(a){a.backgroundColor=a.borderColor}),globalChart.update()):(globalChart.data.datasets.forEach(function(a){a.backgroundColor=void 0}),globalChart.update())}),$("#globalChart").bind("contextmenu",function(){return!1});let tempColor,finalColor,colorWheel=new iro.ColorPicker("#chartBackground",{color:"#fff"});$(".colorBtn").parent("div").on("click",function(){$("#colorModal").modal("show"),tempColor=colorWheel.color.hexString}),$("#cancelColorModal").on("click",function(){finalColor=tempColor}),$("#closeColorModal").on("click",function(){$("#colorModal").modal("hide"),$(".colorBtn").css("background-color",colorWheel.color.rgbaString),globalChart.options.chartArea.backgroundColor=colorWheel.color.rgbaString,globalChart.update()}),$("#resetColorModal").on("click",function(){colorWheel.color.hexString="#ffffff"}),$("#colorModal").on("hidden.bs.modal",function(){colorWheel.color.hexString=finalColor,$(".colorBtn").css("background-color",finalColor)}),colorWheel.on("color:change",function(a){finalColor=colorWheel.color.hexString,$(".colorBtn").css("background-color",a.hexString)});function getCookie(a){var b="; "+document.cookie,c=b.split("; "+a+"=");return 2==c.length?c.pop().split(";").shift():null}$(document).ready(function(){let a=getCookie("lastCountry");a?(a=decodeURIComponent(a),$("#country_selector").countrySelect("setCountry",a),localCountry={name:$("#country_selector").countrySelect("getSelectedCountryData").name.replace(/ *\([^)]*\) */g,""),code:$("#country_selector").countrySelect("getSelectedCountryData").iso2}):$("#country_selector").countrySelect("setCountry",localCountry.name),$("#localCountry").remove()}),$("#zoom").on("change",function(){"off"==this.value?globalChart.options.plugins.zoom.zoom.enabled=!1:(globalChart.options.plugins.zoom.zoom.enabled=!0,globalChart.options.plugins.zoom.zoom.mode=this.value),globalChart.update()}),$("#pan").on("change",function(){"off"==this.value?globalChart.options.plugins.zoom.pan.enabled=!1:(globalChart.options.plugins.zoom.pan.enabled=!0,globalChart.options.plugins.zoom.pan.mode=this.value),globalChart.update()});